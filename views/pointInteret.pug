doctype html
html
    head
        include ./commons/header.pug
        link(rel="stylesheet" href="/stylesheets/pointInteret-page.css")
        link(rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css")
        link(rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css")
        style.
            #map { z-index: 1; }
            .leaflet-interactive { cursor: pointer; }
            .selected-arrondissement {
                fill: #FF0000 !important; /* Red color for selected arrondissement */
                fill-opacity: 0.5 !important; /* Adjust opacity as needed */
            }

    body
        include ./commons/navbar.pug
        main
            .section1
                h1.heading-point-interet Points d'intérêt
                p.sub-heading-point-interet Le site propose beaucoup de lieu d'interet dans le grand montreal qui pourrait etre utile pour les amateurs de velo
                h3.heading-point-interet-2 Territoires:
                #map(style="height: 400px;").img-google-map
                .map-point-interet
                    form(action="")
                        .row.arrondissement-container
                            .col-6
                                label(for="arrondissement") Arrondissement
                            .col-6
                                select(name="arrondissement", id="arrondissement").form-select.select-1
                                    option(value="Tous") Tous
                                    each arrondissement in uniqueArrondissements
                                        -var a = arrondissement
                                        option(value=a) #{a}
                        .row.lieu-container
                            .col-6
                                label(for="typeDeLieu") Type de lieu:
                            .col-6
                                select(name="typeDeLieu", id="TypeDeLieu").form-select.select-1
                                    option(value="Fontaine à boire") Fontaine à boire
            .sectionTable
                table.table.table-hover#myTable
                    thead
                        tr
                            th Identifiant
                            th Type
                            th Arrondissement
                            th Nom De Lieu
                            th Proximité jeux repère
                    tbody
                        each fontaine in listFontaines
                            -var id = fontaine.ID
                            -var arrondissement = fontaine.Arrondissement
                            -var nomLieu = fontaine.Nom_parc_lieu
                            -var proximite = fontaine.Proximité_jeux_repère
                            tr
                                td #{id}
                                td Fontaine à boire
                                td #{arrondissement}
                                td #{nomLieu}
                                td #{proximite}
        include ./commons/footer.pug

script(src="https://code.jquery.com/jquery-3.7.1.min.js")
script(src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js")
script(src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js")
script.
    $(document).ready(function () {
        $('#myTable').DataTable();

        // Initialize map
        var map = L.map('map').setView([45.5017, -73.5673], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var geojsonLayer; 
        var selectedArrondissementLayer = null;

        // Load GeoJSON data
        $.getJSON('/data/territoires.geojson', function (data) {
            geojsonLayer = L.geoJSON(data, {
                style: function (feature) {
                    return {
                        fillColor: '#ADD8E6',
                        weight: 2,
                        opacity: 1,
                        color: 'white',
                        fillOpacity: 0.7
                    };
                },
                onEachFeature: function (feature, layer) {
                  layer.on({
                    mouseover: function (e) {
                      layer.setStyle({
                        weight: 5,
                        color: '#666',
                        fillOpacity: 0.9
                      });
                    },
                    mouseout: function (e) {
                      if (selectedArrondissementLayer === null || selectedArrondissementLayer != layer) {
                            geojsonLayer.resetStyle(layer);
                      } else {
                           layer.setStyle({
                               fillColor: '#FF0000',
                               weight: 2,
                               opacity: 1,
                               color: 'white',
                               fillOpacity: 0.5
                           });

                      }

                    },
                    click: function (e) {
                      map.fitBounds(e.target.getBounds());
                    }
                  });
                }
            }).addTo(map);
        });

        $('#arrondissement').change(function () {
            var selectedArrondissement = $(this).val();

            if (selectedArrondissementLayer !== null) {
                geojsonLayer.resetStyle(selectedArrondissementLayer);
                selectedArrondissementLayer = null;
            }
            geojsonLayer.eachLayer(function(layer){
               if(layer.feature.properties.NOM == selectedArrondissement){
                 selectedArrondissementLayer = layer;
                 layer.setStyle({
                      fillColor: '#FF0000',
                      weight: 2,
                      opacity: 1,
                      color: 'white',
                      fillOpacity: 0.5
                  });
               }
            });

        });
    });

